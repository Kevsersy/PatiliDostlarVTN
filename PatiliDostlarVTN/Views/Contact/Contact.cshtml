@model PatiliDostlarVTN.Models.Entities.Contact

<section class="bg-light">
    <div class="container py-4">
        <div class="row align-items-center justify-content-between">
            <div class="contact-header col-lg-4">
                <h1 class="h2 pb-3 text-primary">İletişim</h1>
                <h3 class="h4 regular-400">Sayfamızdan randevu alarak kampanyalı paketlerimizden yararlanın!</h3>
                <p class="light-300">
                    Randevu alıp gelen patili dost ebeveynleri hem indirimli fiyatlardan yararlanırken hem de yılda bir kez tamamen ücretsiz bir şekilde Pet Kuaför hizmetimizden yararlandığını biliyor muydunuz?
                </p>
            </div>
            <div class="contact-img col-lg-5 align-items-end col-md-4">
                <img src="~/assets/img/animals floating with balloons-pana.svg" alt="Animals with balloons">
            </div>
        </div>
    </div>
</section>

<section class="container py-5">
    <h1 class="col-12 col-xl-8 h2 text-left text-primary pt-3">
        7/24 hizmet | aynı gün randevu
    </h1>
    <h2 class="col-12 col-xl-8 h4 text-left regular-400">Bize Ulaşın</h2>
    <p class="col-12 col-xl-8 text-left text-muted pb-5 light-300">
        Aşağıdaki kanallardan randevunuzu alabilirsiniz.
    </p>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <form asp-action="Submit" asp-controller="Contact" method="POST" id="appointmentForm">
        <div class="row mb-4">
            <div class="col-lg-6">
                <label asp-for="Name">Adınız</label>
                <input asp-for="Name" class="form-control" required />
            </div>
            <div class="col-lg-6">
                <label asp-for="Email">E-posta</label>
                <input asp-for="Email" type="email" class="form-control" required />
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-6">
                <label asp-for="Phone">Telefon</label>
                <input asp-for="Phone" class="form-control" required />
            </div>
            <div class="col-lg-6">
                <label asp-for="Company">Pati Türü</label>
                <input asp-for="Company" class="form-control" />
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-lg-6">
                <label asp-for="AppointmentDate">Randevu Tarihi</label>
                <input asp-for="AppointmentDate" type="date" class="form-control" id="appointmentDate" required />
            </div>
            <div class="col-lg-6">
                <label>Randevu Saati</label>
                <select asp-for="AppointmentTime" class="form-control" id="appointmentTime" required>
                    <option value="" disabled selected>Randevu Saati Seçin</option>
                    @for (int hour = 9; hour <= 17; hour++)
                    {
                        @for (int minute = 0; minute < 60; minute += 30)
                        {
                            var time = $"{hour:D2}:{minute:D2}";
                            <option value="@time">@time</option>
                        }
                    }
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Randevu Al</button>
    </form>
</section>

<script>
    document.getElementById("appointmentDate").addEventListener("change", function () {
        var selectedDate = this.value;

        fetch(`/Contact/GetUnavailableTimes?date=${selectedDate}`)
            .then(response => response.json())
            .then(data => {
                var timeSelect = document.getElementById("appointmentTime");
                var options = timeSelect.options;

                for (var i = 0; i < options.length; i++) {
                    if (data.includes(options[i].value)) {
                        options[i].disabled = true;
                    } else {
                        options[i].disabled = false;
                    }
                }
            })
            .catch(error => console.error("Randevu saatleri yüklenirken hata oluştu:", error));
    });

    document.getElementById("appointmentForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Varsayılan form gönderimini engelle

        var form = this;

        fetch(form.action, {
            method: form.method,
            body: new FormData(form)
        })
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url; // Backend'den gelen yönlendirmeyi takip et
            } else {
                return response.text();
            }
        })
        .then(html => {
            if (html) {
                document.body.innerHTML = html; // Sayfayı güncelle
            }
        })
        .catch(error => console.error("Form gönderilirken hata oluştu:", error));
    });
</script>
